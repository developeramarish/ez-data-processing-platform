apiVersion: v1
kind: ConfigMap
metadata:
  name: services-config
  namespace: {{ .Values.global.namespace }}
  labels:
    {{- include "ez-platform.labels" . | nindent 4 }}
data:
  # MongoDB Configuration
  mongodb-connection: {{ include "ez-platform.mongodbConnectionString" . | quote }}
  database-name: {{ .Values.config.databaseName | default "ezplatform" | quote }}

  # Kafka Configuration
  kafka-server: {{ include "ez-platform.kafkaBootstrapServers" . | quote }}

  # Hazelcast Configuration
  hazelcast-server: {{ include "ez-platform.hazelcastMembers" . | quote }}

  # Hazelcast TTL Configuration
  # Deduplication TTL: How long file hashes are cached to prevent reprocessing
  FileDiscovery__DeduplicationTTLHours: {{ .Values.config.fileDiscovery.deduplicationTTLHours | default "0.25" | quote }}

  # Cache TTL: How long file content is cached during processing pipeline
  Hazelcast__CacheTTLHours: {{ .Values.config.hazelcast.cacheTTLHours | default "1" | quote }}

  # Prometheus Configuration
  prometheus-endpoint: {{ printf "http://prometheus-system.%s.svc.cluster.local:9090" .Values.global.namespace | quote }}
  prometheus-business-endpoint: {{ printf "http://prometheus-business.%s.svc.cluster.local:9091" .Values.global.namespace | quote }}
  prometheus-pushgateway: {{ printf "http://prometheus-pushgateway.%s.svc.cluster.local:9091" .Values.global.namespace | quote }}

  # OpenTelemetry Configuration
  otlp-endpoint: {{ include "ez-platform.otelEndpoint" . | quote }}

  # Elasticsearch Configuration
  elasticsearch-endpoint: {{ include "ez-platform.elasticsearchEndpoint" . | quote }}

  # Logging Configuration
  Logging__LogLevel__Default: {{ .Values.config.logLevel | default "Information" | quote }}
  Logging__LogLevel__Microsoft: {{ .Values.config.logLevelMicrosoft | default "Warning" | quote }}
  Logging__LogLevel__System: {{ .Values.config.logLevelSystem | default "Warning" | quote }}

  # Environment
  ASPNETCORE_ENVIRONMENT: {{ .Values.config.environment | default "Production" | quote }}
